# 03. Микросервисы: подходы

## Задача 1. Обеспечить разработку

_Предложите решение для обеспечения процесса разработки: хранение исходного кода, непрерывная интеграция и непрерывная поставка. 
Решение может состоять из одного или нескольких программных продуктов и должно описывать способы и принципы их взаимодействия._ 

Здесь по скорости и простоте развёртывания, наверное, лучше всего подойдёт gitlab.  
* можно развернуть собственный инстанс, либо использовать managed-решение от облачного провайдера
* git и гибкое управление репозиториями
* относительно гибкая система настройки и управления CI/CD
* Внешние раннеры и возможность их параллельного запуска
* возможность хранить секреты в переменных репозитория + интеграция с внешними хранилищами, такими как Hashicorp Vault
* собственное хранилище артефактов либо внешний S3 storage


## Задача 2. Логи

_Предложите решение для обеспечения сбора и анализа состояния хостов и сервисов в микросервисной архитектуре. 
Решение может состоять из одного или нескольких программных продуктов и должно описывать способы и принципы их взаимодействия._

Традиционный ответ на этот вопрос - использовать ELK stack.
* Elasticsearch - хранение, индексация и поиск данных
* Kibana - интерфейс
* Logstash/fluentd/fluentbit - сборка из разных источников, трансформация и пересылка данных

Однако, несмотря на популярность, эксплуатация при больших нагрузках и объёмах данных - весьма ресурсоёмкая и требует профессионализма.

Если мы строим систему с нуля, может иметь смысл рассмотреть более современные варианты.
Например, использовать в качестве агента сборки, для преобразования и маршрутизации [Vector](https://vector.dev/) - 
Легковесный, быстрый и гибкий инструмент, имеющий богатый выбор как источников данных, так и конечных точек для отправки.
А в качестве хранилища и инструмента работы с данными использовать Grafana Loki. Инструмент в известном многим интерфейсе Grafana, 
со схожим с elastic языком запросов. Из особенностей следует отметить отсутствие полнотекстового поиска. 
Используется быстрый поиск только по меткам и затем уже поиск по тексту, т.к. данные хранятся в файлах. 
Что, разумеется, приводит к зависимости скорости обработки поисковых запросов от их сложности и объёма данных.
Для больших нагрузок может быть целесообразно использовать для хранения ClickHouse с той же Grafana или [qryn](https://github.com/metrico/qryn-view) в качестве UI.

## Задача 3. Мониторинг

_Предложите решение для обеспечения сбора и анализа состояния хостов и сервисов в микросервисной архитектуре. 
Решение может состоять из одного или нескольких программных продуктов и должно описывать способы и принципы их взаимодействия._

Решение для мониторинга в "облачных" условиях снова стандартное - использовать стек nodeExporter+prometheus+Grafana+AlertManager.
Как альтернативу можно рекомендовать стек от [VictoriaMetrics](https://docs.victoriametrics.com/quick-start/) - то же самое, но обещает
быть более быстрым и менее ресурсоёмким.

Использовать Zabbix так же возможно, но сложнее старт, труднее масштабировать, хуже с большими потоками данных.
